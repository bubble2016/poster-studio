<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>包站公告发布系统 Web</title>
  <link rel="icon" href="/favicon.ico?v=20260212" type="image/x-icon" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css?v=20260214m7" />
</head>
<body>
  <div class="bg-orb orb-a"></div>
  <div class="bg-orb orb-b"></div>

  <main class="app">
    <header class="topbar">
      <div class="brand-shell">
        <div class="brand-mark-wrap" aria-hidden="true">
          <img class="brand-mark" src="/favicon.ico" alt="" />
        </div>
        <div class="brand-copy">
          <p class="brand-kicker">POSTER STUDIO</p>
          <h1>打包站公告发布工具</h1>
          <p class="brand-meta">快捷的公告发布系统，专为打包站打造</p>
        </div>
      </div>
      <div class="topbar-actions">
        <button id="openSettingsBtn" class="ghost-btn icon-btn" aria-label="设置" title="设置" type="button" aria-haspopup="menu" aria-expanded="false" aria-controls="settingsMenu">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 7.25a1.25 1.25 0 0 1 1.25-1.25h13.5a1.25 1.25 0 1 1 0 2.5H5.25A1.25 1.25 0 0 1 4 7.25Zm0 4.75a1.25 1.25 0 0 1 1.25-1.25h13.5a1.25 1.25 0 1 1 0 2.5H5.25A1.25 1.25 0 0 1 4 12Zm0 4.75a1.25 1.25 0 0 1 1.25-1.25h13.5a1.25 1.25 0 1 1 0 2.5H5.25A1.25 1.25 0 0 1 4 16.75Z"/>
          </svg>
        </button>
        <div id="settingsMenu" class="settings-menu" role="menu" aria-label="设置菜单" hidden>
          <p id="settingsMenuUser" class="settings-menu-user">当前身份：未登录</p>
          <button id="settingsMenuAuthBtn" class="settings-menu-item" type="button" role="menuitem">登录 / 注册</button>
          <button id="clearGuestDraftBtn" class="settings-menu-item" type="button" role="menuitem" hidden>清空访客草稿</button>
          <button id="settingsMenuPanelBtn" class="settings-menu-item" type="button" role="menuitem">打开设置</button>
        </div>
      </div>
    </header>

    <div class="workspace">
      <section class="card preview-card">
        <div class="section-head">
          <h2>实时预览</h2>
          <div class="preview-tools">
            <span id="statusText" aria-live="polite">准备就绪</span>
            <button id="togglePreviewFocusBtn" class="ghost-btn preview-focus-btn" type="button" aria-pressed="false">全屏预览</button>
          </div>
        </div>
        <div id="previewStage" class="preview-stage is-loading">
          <div id="previewPlaceholder" class="preview-placeholder">正在生成预览...</div>
          <img id="previewImage" alt="海报预览" />
        </div>
      </section>

      <section class="editor-col" id="editorDrawer">
        <button id="editorDrawerToggleBtn" class="drawer-toggle" type="button" aria-expanded="false" hidden>展开编辑区</button>
        <section class="card form-card">
          <div class="field-grid">
            <label>标题<input id="titleInput" /></label>
            <label>日期<input id="dateInput" placeholder="今天 / 2026-02-11" /></label>
          </div>
          <div class="row">
            <button class="mini-btn" id="todayBtn">今天</button>
            <button class="mini-btn" id="tomorrowBtn">+1 天</button>
            <button class="mini-btn" id="formatBtn">自动格式化</button>
            <button class="mini-btn" id="batchBtn">批量调价</button>
          </div>
          <textarea id="contentInput" rows="10" hidden placeholder="请输入正文内容"></textarea>
          <div id="priceEditorPanel">
            <div class="section-head"><h2>价格表内容</h2></div>
            <p class="price-editor-tip">直接在下方编辑，生成时会自动转为正文格式。</p>
            <div class="price-editor-table-wrap">
              <table class="price-editor-table">
                <colgroup>
                  <col class="col-name" />
                  <col class="col-mode" />
                  <col class="col-value" />
                  <col class="col-unit" />
                  <col class="col-action" />
                </colgroup>
                <thead>
                  <tr>
                    <th>品类</th>
                    <th>类型</th>
                    <th>值</th>
                    <th>单位</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="priceTableBody"></tbody>
              </table>
            </div>
            <div class="price-editor-add-wrap">
              <button class="mini-btn" id="addPriceRowBtn" type="button">新增一行</button>
            </div>
            <label>附加说明（非价格内容）
              <textarea id="priceEditorExtra" rows="6" placeholder="例如：温馨提示、假期通知等"></textarea>
            </label>
          </div>
          <div class="stats" id="statsText">0 字 · 0 行</div>
        </section>

        <section class="card">
          <div class="section-head"><h2>模板管理</h2></div>
          <div class="field-grid">
            <label>模板
              <select id="templateSelect"></select>
            </label>
            <label>导出格式
              <select id="exportFormat">
                <option>PNG</option>
                <option>JPEG</option>
                <option>PDF</option>
              </select>
            </label>
          </div>
          <div class="row">
            <button class="mini-btn" id="saveTemplateBtn">保存模板</button>
            <button class="mini-btn danger" id="deleteTemplateBtn">删除模板</button>
          </div>
        </section>

        <footer class="action-bar">
          <button id="generateBtn" class="primary pill-btn">生成</button>
          <p id="actionBarNote" class="action-bar-note">
            <span>© 2026 开发者：李学涛</span>
            <span class="action-bar-sep">|</span>
            <a class="action-bar-link" href="/terms" target="_blank" rel="noopener noreferrer">用户协议</a>
            <span class="action-bar-sep">|</span>
            <a class="action-bar-link" href="/privacy" target="_blank" rel="noopener noreferrer">隐私政策</a>
          </p>
        </footer>
      </section>
    </div>
  </main>

  <div id="settingsModal" class="modal hidden" aria-hidden="true">
    <div id="settingsMask" class="modal-mask"></div>
    <section class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <header class="modal-head">
        <h2 id="settingsTitle">全局设置</h2>
        <button id="closeSettingsBtn" class="ghost-btn">关闭</button>
      </header>
      <div class="modal-body">
        <div class="settings-tabs" role="tablist" aria-label="设置分组">
          <button class="settings-tab is-active" type="button" role="tab" aria-selected="true" aria-controls="settingsPaneBase" data-settings-tab="base">基础信息</button>
          <button class="settings-tab" type="button" role="tab" aria-selected="false" aria-controls="settingsPaneStyle" data-settings-tab="style">视觉风格</button>
          <button class="settings-tab" type="button" role="tab" aria-selected="false" aria-controls="settingsPaneMedia" data-settings-tab="media">图片素材</button>
          <button class="settings-tab" type="button" role="tab" aria-selected="false" aria-controls="settingsPaneParam" data-settings-tab="param">水印设置</button>
        </div>

        <section id="settingsPaneBase" class="card modal-card settings-pane is-active" role="tabpanel" data-settings-pane="base">
          <div class="section-head"><h2>基础信息</h2></div>
          <label>店铺名称<input id="shopName" /></label>
          <label>联系电话<input id="phone" /></label>
          <label>地址<input id="address" /></label>
          <label>标语<input id="slogan" /></label>
          <label>生成后操作
            <select id="copyMode">
              <option>复制图片</option>
              <option>复制文案</option>
              <option>仅打开文件</option>
            </select>
          </label>
        </section>

        <section id="settingsPaneStyle" class="card modal-card settings-pane" role="tabpanel" data-settings-pane="style" hidden>
          <div class="section-head"><h2>视觉风格</h2></div>
          <div class="field-grid">
            <label class="theme-color-field">主题色
              <div class="theme-color-row">
                <input id="themeColor" type="color" />
                <span id="themeColorHex" class="theme-color-hex">#B22222</span>
              </div>
              <div id="themePalette" class="theme-palette" aria-label="推荐主题色">
                <button type="button" class="theme-swatch" data-color="#D32F2F" title="#D32F2F" aria-label="推荐色 #D32F2F"></button>
                <button type="button" class="theme-swatch" data-color="#2563EB" title="#2563EB" aria-label="推荐色 #2563EB"></button>
                <button type="button" class="theme-swatch" data-color="#16A34A" title="#16A34A" aria-label="推荐色 #16A34A"></button>
                <button type="button" class="theme-swatch" data-color="#EA580C" title="#EA580C" aria-label="推荐色 #EA580C"></button>
                <button type="button" class="theme-swatch" data-color="#7C3AED" title="#7C3AED" aria-label="推荐色 #7C3AED"></button>
                <button type="button" class="theme-swatch" data-color="#0891B2" title="#0891B2" aria-label="推荐色 #0891B2"></button>
              </div>
            </label>
            <label>卡片样式
              <select id="cardStyle">
                <option value="single">单张</option>
                <option value="stack">堆叠</option>
                <option value="block">3D立体</option>
                <option value="flip">翻页</option>
                <option value="ticket">票据</option>
                <option value="double">双层</option>
                <option value="aurora">极光玻璃</option>
                <option value="paper_relief">纸感浮雕</option>
              </select>
            </label>
            <label>价格颜色模式
              <select id="priceColorMode">
                <option value="semantic">保留涨跌红绿</option>
                <option value="theme">跟随主题色</option>
              </select>
            </label>
          </div>
          <label>
            <span class="range-label"><span>背景模糊</span><span id="bgBlurValue" class="range-value">0</span></span>
            <input id="bgBlur" type="range" min="0" max="30" step="1" />
          </label>
          <label>
            <span class="range-label"><span>背景亮度</span><span id="bgBrightnessValue" class="range-value">1.00x</span></span>
            <input id="bgBrightness" type="range" min="0.5" max="1.5" step="0.05" />
          </label>
          <label>
            <span class="range-label"><span>卡片透明度</span><span id="cardOpacityValue" class="range-value">100%</span></span>
            <input id="cardOpacity" type="range" min="0.1" max="1" step="0.05" />
          </label>
          <label>
            <span class="range-label"><span>印章透明度</span><span id="stampOpacityValue" class="range-value">85%</span></span>
            <input id="stampOpacity" type="range" min="0.1" max="1" step="0.05" />
          </label>
        </section>

        <section id="settingsPaneMedia" class="card modal-card settings-pane" role="tabpanel" data-settings-pane="media" hidden>
          <div class="section-head"><h2>图片素材</h2></div>
          <p>访客模式默认不显示 Logo。你可以在这里直接上传自己的包站 Logo、印章和二维码。</p>
          <label>背景预设
            <select id="presetSelect">
              <option value="">不使用预设</option>
            </select>
          </label>
          <div class="field-grid media-grid">
            <label class="upload-field">背景图
              <input id="bgUpload" type="file" accept="image/*" />
              <div class="upload-thumb" id="bgThumbWrap" hidden>
                <img id="bgThumb" alt="背景图缩略图" loading="lazy" />
              </div>
            </label>
            <label class="upload-field">Logo
              <input id="logoUpload" type="file" accept="image/*" />
              <div class="upload-thumb" id="logoThumbWrap" hidden>
                <img id="logoThumb" alt="Logo 缩略图" loading="lazy" />
              </div>
            </label>
            <label class="upload-field">印章
              <input id="stampUpload" type="file" accept="image/*" />
              <div class="upload-thumb" id="stampThumbWrap" hidden>
                <img id="stampThumb" alt="印章缩略图" loading="lazy" />
              </div>
            </label>
            <label class="upload-field">二维码
              <input id="qrUpload" type="file" accept="image/*" />
              <div class="upload-thumb" id="qrThumbWrap" hidden>
                <img id="qrThumb" alt="二维码缩略图" loading="lazy" />
              </div>
            </label>
          </div>
        </section>

        <section id="settingsPaneParam" class="card modal-card settings-pane" role="tabpanel" data-settings-pane="param" hidden>
          <div class="section-head"><h2>水印设置</h2></div>
          <label class="switch-line">
            <input id="watermarkEnabled" type="checkbox" /> 启用水印
          </label>
          <label>水印文字<input id="watermarkText" /></label>
          <label>
            <span class="range-label"><span>水印透明度</span><span id="watermarkOpacityValue" class="range-value">15%</span></span>
            <input id="watermarkOpacity" type="range" min="0.05" max="0.5" step="0.05" />
          </label>
          <label>
            <span class="range-label"><span>水印密度</span><span id="watermarkDensityValue" class="range-value">1.0x</span></span>
            <input id="watermarkDensity" type="range" min="0.5" max="2" step="0.1" />
          </label>
        </section>
      </div>
      <footer class="modal-actions">
        <button id="closeSettingsBtn2">取消</button>
        <button id="saveConfigBtn" class="primary">保存设置</button>
      </footer>
    </section>
  </div>

  <div id="loginModal" class="modal hidden" aria-hidden="true">
    <div id="loginMask" class="modal-mask"></div>
    <section class="modal-panel modal-panel-sm" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <header class="modal-head">
        <h2 id="loginTitle">用户登录</h2>
        <button id="closeLoginBtn" class="ghost-btn" type="button">关闭</button>
      </header>
      <div class="modal-body">
        <label>用户ID
          <input id="loginUserIdInput" placeholder="仅支持字母/数字/_/-" autocomplete="username" />
        </label>
        <label>密码
          <div class="password-row">
            <input id="loginPasswordInput" type="password" placeholder="至少 4 位" autocomplete="current-password" />
            <button id="toggleLoginPwdBtn" class="ghost-btn" type="button">显示</button>
          </div>
        </label>
        <div id="loginErrorText" class="form-error" aria-live="polite"></div>
      </div>
      <footer class="modal-actions">
        <button id="cancelLoginBtn" type="button">取消</button>
        <button id="confirmLoginBtn" class="primary" type="button">登录/创建</button>
      </footer>
    </section>
  </div>

  <div id="logoCropModal" class="modal hidden" aria-hidden="true">
    <div id="logoCropMask" class="modal-mask"></div>
    <section class="modal-panel modal-panel-sm" role="dialog" aria-modal="true" aria-labelledby="logoCropTitle">
      <header class="modal-head">
        <h2 id="logoCropTitle">裁剪 Logo</h2>
        <button id="closeLogoCropBtn" class="ghost-btn" type="button">关闭</button>
      </header>
      <div class="modal-body">
        <p class="crop-tip">用手指直接拖动预览区域即可移动裁剪位置，建议将主体放在中间。</p>
        <canvas id="logoCropCanvas" width="320" height="320"></canvas>
        <label>缩放<input id="logoCropScale" type="range" min="1" max="3" step="0.01" value="1" /></label>
      </div>
      <footer class="modal-actions">
        <button id="cancelLogoCropBtn" type="button">取消</button>
        <button id="confirmLogoCropBtn" class="primary" type="button">确认裁剪</button>
      </footer>
    </section>
  </div>

  <div id="priceRowDrawerModal" class="modal hidden" aria-hidden="true">
    <div id="priceDrawerMask" class="modal-mask"></div>
    <section class="modal-panel modal-panel-sm price-drawer-panel" role="dialog" aria-modal="true" aria-labelledby="priceDrawerTitle">
      <header class="modal-head">
        <h2 id="priceDrawerTitle">编辑纸种</h2>
        <button id="closePriceDrawerBtn" class="ghost-btn" type="button">关闭</button>
      </header>
      <div class="modal-body">
        <div class="drawer-row drawer-row-2">
          <label class="drawer-inline-field"><span class="drawer-field-label">纸种</span><input id="priceDrawerName" /></label>
          <label class="drawer-inline-field"><span class="drawer-field-label">单位</span><input id="priceDrawerUnit" placeholder="元/吨" /></label>
        </div>
        <div class="drawer-row drawer-row-2 drawer-type-value-row">
          <label class="drawer-inline-field"><span class="drawer-field-label">类型</span>
            <select id="priceDrawerMode">
              <option value="number">单价</option>
              <option value="range">区间</option>
              <option value="text">文字</option>
            </select>
          </label>
          <div class="drawer-value-slot">
            <div id="priceDrawerValueNumberWrap">
              <label class="drawer-inline-field"><span class="drawer-field-label">值</span><input id="priceDrawerValue" placeholder="例如：1350" /></label>
            </div>
            <div id="priceDrawerValueRangeWrap" class="drawer-row drawer-range-wrap" hidden>
              <input class="drawer-range-input" id="priceDrawerMin" />
              <span class="drawer-range-sep" aria-hidden="true">-</span>
              <input class="drawer-range-input" id="priceDrawerMax" />
            </div>
            <div id="priceDrawerValueTextWrap" hidden>
              <label class="drawer-inline-field"><span class="drawer-field-label">说明</span><input id="priceDrawerText" placeholder="例如：上调50" /></label>
            </div>
          </div>
        </div>
      </div>
      <footer class="modal-actions modal-actions-3">
        <button id="deletePriceDrawerBtn" class="danger" type="button">删除</button>
        <button id="cancelPriceDrawerBtn" type="button">取消</button>
        <button id="savePriceDrawerBtn" class="primary" type="button">保存</button>
      </footer>
    </section>
  </div>

  <div id="dialogModal" class="modal hidden" aria-hidden="true">
    <div id="dialogMask" class="modal-mask"></div>
    <section class="modal-panel modal-panel-sm dialog-panel" role="dialog" aria-modal="true" aria-labelledby="dialogTitle">
      <header class="modal-head">
        <h2 id="dialogTitle">提示</h2>
        <button id="closeDialogBtn" class="ghost-btn" type="button">关闭</button>
      </header>
      <div class="modal-body">
        <p id="dialogMessage" class="dialog-message"></p>
        <label id="dialogInputWrap" hidden>请输入
          <input id="dialogInput" />
        </label>
      </div>
      <footer class="modal-actions">
        <button id="dialogCancelBtn" type="button">取消</button>
        <button id="dialogConfirmBtn" class="primary" type="button">确定</button>
      </footer>
    </section>
  </div>

  <script src="/static/app.js?v=20260214m7"></script>
</body>
</html>

